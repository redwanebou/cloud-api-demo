pipeline {
  agent {
    docker {
      filename 'Dockerfile'
      args '-p 3000:3000 -p 5000:5000'
    }
  }
  tools { nodejs "redwaneJS" }
  environment {
    CI = 'true'
  }
  stages {
    stage('Npm Install') {
      steps {
        // npm install @angular/cli
        // cd "AutoAPI"/ClientApp
        // npm install
        sh 'echo "Installing..."'
      }
    }

    stage('Build Production Mode') {
      steps {
            sh 'echo "Building..."'
            //sh 'cd ./DevAutoAPI/ClientApp'
           // sh 'npm install'
            //sh 'dotnet publish -c Release'
            sh 'cd ..'
            sh 'dotnet publish -c Release'
      }
     }


    stage('Deploy to production enviroment'){
     when {
            branch 'master'
       }
       steps {
          // cd "AutoAPI"/ClientApp
          // npm run "build"
          sh 'echo "Deploy on master branch"'
       }
     }


    stage('Deploy to test enviroment'){
     when {
            branch 'test'
       }
       steps {
          // cd "AutoAPI"/ClientApp
          // npm run "build"
          input message: 'Deploy on test branch'
       }
     }
   }
 }
